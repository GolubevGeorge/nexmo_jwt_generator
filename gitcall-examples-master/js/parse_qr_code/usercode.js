
// build command: npm install jsqr pngjs

const {PNG} = require('pngjs');
const jsqr = require("jsqr");

// An example QR code. Contains "hello world" as data.
const img = "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";

module.exports = (data) => {
    const dataUri = 'data:image/png;base64,'+img;
    const png = PNG.sync.read(Buffer.from(dataUri.slice('data:image/png;base64,'.length), 'base64'));
    const code = jsqr(Uint8ClampedArray.from(png.data), png.width, png.height);

    data.qr = code;

    return data;
};
